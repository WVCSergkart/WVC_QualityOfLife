<?xml version="1.0" encoding="utf-8"?>
<Defs>

	<XmlExtensions.PatchDef Name="WVC_BodyPartGenerator_GlobalVersion" Abstract="True">
		<parameters>
			<li>partEfficiencyValue</li>
			<li>bodyTypeName</li>
			<li>BodyPartMarketValue</li>
		</parameters>
		<apply>

			<Operation Class="XmlExtensions.ForEach">
				<xpath>/Defs/BodyPartDef</xpath>
				<storeIn>DEF</storeIn>
				<apply>

					<Operation Class="XmlExtensions.ConditionalInherited">
						<xpathDef>{DEF}</xpathDef>
						<xpathLocal>destroyableByDamage</xpathLocal>
						<caseFalse>

					<Operation Class="XmlExtensions.ConditionalInherited">
						<xpathDef>{DEF}</xpathDef>
						<xpathLocal>conceptual</xpathLocal>
						<caseFalse>

					<Operation Class="XmlExtensions.ConditionalInherited">
						<xpathDef>{DEF}</xpathDef>
						<xpathLocal>tags[li="ConsciousnessSource"]</xpathLocal>
						<caseFalse>

					<Operation Class="XmlExtensions.ConditionalInherited">
						<xpathDef>{DEF}</xpathDef>
						<xpathLocal>tags[li="BreathingPathway"]</xpathLocal>
						<caseFalse>

					<Operation Class="XmlExtensions.Conditional">
						<xpath>{DEF}/defName</xpath>
						<caseTrue>

					<Operation Class="XmlExtensions.Conditional">
						<xpath>{DEF}/label</xpath>
						<caseTrue>

					<Operation Class="XmlExtensions.Conditional">
						<xpath>{DEF}[label="head"]</xpath>
						<caseFalse>

							<!-- <Operation Class="XmlExtensions.Log"> -->
								<!-- <xpath>{DEF}/defName</xpath> -->
							<!-- </Operation> -->

							<Operation Class="XmlExtensions.CreateVariable">
								<value>{DEF}/label</value>
								<storeIn>label_DEF</storeIn>
								<fromXml>true</fromXml>
								<apply>

							<Operation Class="XmlExtensions.CreateVariable">
								<value>{DEF}/defName</value>
								<storeIn>DefName</storeIn>
								<fromXml>true</fromXml>
								<apply>

									<!--=====================================================================-->

									<Operation Class="PatchOperationAdd">
										<xpath>/Defs</xpath>
										<value>

										  <HediffDef ParentName="WVC_AutoGeneratedBodyParts_AddedBodyPartBase">
											<defName>WVC_AutoBodyPart_{bodyTypeName}{DefName}c</defName>
											<label>{bodyTypeName} {label_DEF}</label>
											<descriptionHyperlinks><ThingDef>WVC_AutoBodyPart_{bodyTypeName}{DefName}c</ThingDef></descriptionHyperlinks>
											<spawnThingOnRemoved>WVC_AutoBodyPart_{bodyTypeName}{DefName}c</spawnThingOnRemoved>
											<addedPartProps>
											  <solid>true</solid>
											  <partEfficiency>{partEfficiencyValue}</partEfficiency>
											  <betterThanNatural>true</betterThanNatural>
											</addedPartProps>
										  </HediffDef>

										  <ThingDef ParentName="WVC_AutoGeneratedBodyParts_BodyPartBase">
											<defName>WVC_AutoBodyPart_{bodyTypeName}{DefName}c</defName>
											<label>{bodyTypeName} {label_DEF}</label>
											<descriptionHyperlinks>
												<RecipeDef>Install_WVC_AutoBodyPart_{bodyTypeName}{DefName}c</RecipeDef>
											</descriptionHyperlinks>
											<statBases>
											  <MarketValue>{BodyPartMarketValue}</MarketValue>
											  <Mass>3</Mass>
											  <DeteriorationRate>0</DeteriorationRate>
											</statBases>
											<thingCategories>
											  <li>WVC_AutoGeneratedBodyParts_{bodyTypeName}</li>
											</thingCategories>
										  </ThingDef>

										  <RecipeDef ParentName="SurgeryInstallBodyPartArtificialBase">
											<defName>Install_WVC_AutoBodyPart_{bodyTypeName}{DefName}c</defName>
											<label>install {bodyTypeName} {label_DEF}</label>
											<description>Install an {bodyTypeName} {label_DEF}.</description>
											<descriptionHyperlinks>
											  <ThingDef>WVC_AutoBodyPart_{bodyTypeName}{DefName}c</ThingDef>
											  <HediffDef>WVC_AutoBodyPart_{bodyTypeName}{DefName}c</HediffDef>
											</descriptionHyperlinks>
											<jobString>Installing {label_DEF}.</jobString>
											<ingredients>
											  <li>
												<filter>
												  <thingDefs>
													<li>WVC_AutoBodyPart_{bodyTypeName}{DefName}c</li>
												  </thingDefs>
												</filter>
												<count>1</count>
											  </li>
											</ingredients>
											<fixedIngredientFilter>
											  <thingDefs>
												<li>WVC_AutoBodyPart_{bodyTypeName}{DefName}c</li>
											  </thingDefs>
											</fixedIngredientFilter>
											<appliedOnFixedBodyParts>
											  <li>{DefName}</li>
											</appliedOnFixedBodyParts>
											<addsHediff>WVC_AutoBodyPart_{bodyTypeName}{DefName}c</addsHediff>
										  </RecipeDef>

										</value>
									</Operation>

									<Operation Class="XmlExtensions.PatchOperationSafeAdd">
										<xpath>/Defs/ThingDef[@Name="BasePawn"]</xpath>
										<safetyDepth>1</safetyDepth>
										<value>
											<recipes>
												<li>Install_WVC_AutoBodyPart_{bodyTypeName}{DefName}c</li>
											</recipes>
										</value>
									</Operation>

								</apply>
							</Operation>

								</apply>
							</Operation>

						</caseFalse>
					</Operation>

						</caseTrue>
						<caseFalse>

							<Operation Class="XmlExtensions.CreateVariable">
								<value>{DEF}/defName</value>
								<storeIn>DefName</storeIn>
								<fromXml>true</fromXml>
								<apply>

									<!--=====================================================================-->

									<Operation Class="PatchOperationAdd">
										<xpath>/Defs</xpath>
										<value>

										  <HediffDef ParentName="WVC_AutoGeneratedBodyParts_AddedBodyPartBase">
											<defName>WVC_AutoBodyPart_{bodyTypeName}{DefName}c</defName>
											<label>{bodyTypeName} exotic body part</label>
											<descriptionHyperlinks><ThingDef>WVC_AutoBodyPart_{bodyTypeName}{DefName}c</ThingDef></descriptionHyperlinks>
											<spawnThingOnRemoved>WVC_AutoBodyPart_{bodyTypeName}{DefName}c</spawnThingOnRemoved>
											<addedPartProps>
											  <solid>true</solid>
											  <partEfficiency>{partEfficiencyValue}</partEfficiency>
											  <betterThanNatural>true</betterThanNatural>
											</addedPartProps>
										  </HediffDef>

										  <ThingDef ParentName="WVC_AutoGeneratedBodyParts_BodyPartBase">
											<defName>WVC_AutoBodyPart_{bodyTypeName}{DefName}c</defName>
											<label>{bodyTypeName} exotic body part</label>
											<descriptionHyperlinks>
												<RecipeDef>Install_WVC_AutoBodyPart_{bodyTypeName}{DefName}c</RecipeDef>
											</descriptionHyperlinks>
											<statBases>
											  <MarketValue>{BodyPartMarketValue}</MarketValue>
											  <Mass>3</Mass>
											  <DeteriorationRate>0</DeteriorationRate>
											</statBases>
											<thingCategories>
											  <li>WVC_AutoGeneratedBodyParts_{bodyTypeName}</li>
											</thingCategories>
										  </ThingDef>

										  <RecipeDef ParentName="SurgeryInstallBodyPartArtificialBase">
											<defName>Install_WVC_AutoBodyPart_{bodyTypeName}{DefName}c</defName>
											<label>install {bodyTypeName} exotic body part</label>
											<description>Install an {bodyTypeName} exotic body part.</description>
											<descriptionHyperlinks>
											  <ThingDef>WVC_AutoBodyPart_{bodyTypeName}{DefName}c</ThingDef>
											  <HediffDef>WVC_AutoBodyPart_{bodyTypeName}{DefName}c</HediffDef>
											</descriptionHyperlinks>
											<jobString>Installing {label_DEF}.</jobString>
											<ingredients>
											  <li>
												<filter>
												  <thingDefs>
													<li>WVC_AutoBodyPart_{bodyTypeName}{DefName}c</li>
												  </thingDefs>
												</filter>
												<count>1</count>
											  </li>
											</ingredients>
											<fixedIngredientFilter>
											  <thingDefs>
												<li>WVC_AutoBodyPart_{bodyTypeName}{DefName}c</li>
											  </thingDefs>
											</fixedIngredientFilter>
											<appliedOnFixedBodyParts>
											  <li>{DefName}</li>
											</appliedOnFixedBodyParts>
											<addsHediff>WVC_AutoBodyPart_{bodyTypeName}{DefName}c</addsHediff>
										  </RecipeDef>

										</value>
									</Operation>

									<Operation Class="XmlExtensions.PatchOperationSafeAdd">
										<xpath>/Defs/ThingDef[@Name="BasePawn"]</xpath>
										<safetyDepth>1</safetyDepth>
										<value>
											<recipes>
												<li>Install_WVC_AutoBodyPart_{bodyTypeName}{DefName}c</li>
											</recipes>
										</value>
									</Operation>

								</apply>
							</Operation>

						</caseFalse>
					</Operation>

						</caseTrue>
					</Operation>

						</caseFalse>
					</Operation>

						</caseFalse>
					</Operation>

						</caseFalse>
					</Operation>

						</caseFalse>
					</Operation>

				</apply>
			</Operation>

			<Operation Class="XmlExtensions.ForEach">
				<xpath>/Defs/BodyDef/corePart/def</xpath>
				<storeIn>DEF</storeIn>
				<apply>

					<!-- <Operation Class="XmlExtensions.Log"> -->
						<!-- <xpath>{DEF}/corePart/def</xpath> -->
					<!-- </Operation> -->

					<Operation Class="XmlExtensions.CreateVariable">
						<value>{DEF}/corePart/def</value>
						<storeIn>DefName</storeIn>
						<fromXml>true</fromXml>
						<apply>

							<Operation Class="XmlExtensions.PatchOperationSafeRemove">
								<xpath>/Defs/HediffDef[defName="WVC_AutoBodyPart_{bodyTypeName}{DefName}c"]</xpath>
							</Operation>
							<Operation Class="XmlExtensions.PatchOperationSafeRemove">
								<xpath>/Defs/ThingDef[defName="WVC_AutoBodyPart_{bodyTypeName}{DefName}c"]</xpath>
							</Operation>
							<Operation Class="XmlExtensions.PatchOperationSafeRemove">
								<xpath>/Defs/RecipeDef[defName="Install_WVC_AutoBodyPart_{bodyTypeName}{DefName}c"]</xpath>
							</Operation>
							<Operation Class="XmlExtensions.PatchOperationSafeRemove">
								<xpath>/Defs/ThingDef[@Name="BasePawn"]/recipes[li="Install_WVC_AutoBodyPart_{bodyTypeName}{DefName}c"]</xpath>
							</Operation>

						</apply>
					</Operation>

				</apply>
			</Operation>

			<Operation Class="XmlExtensions.PatchOperationSafeRemove">
				<xpath>/Defs/HediffDef[defName="WVC_AutoBodyPart_{bodyTypeName}Headc" or li="Install_WVC_AutoBodyPart_{bodyTypeName}MechanicalHeadc" or li="Install_WVC_AutoBodyPart_{bodyTypeName}SnakeHeadc"]</xpath>
			</Operation>
			<Operation Class="XmlExtensions.PatchOperationSafeRemove">
				<xpath>/Defs/ThingDef[defName="WVC_AutoBodyPart_{bodyTypeName}Headc" or li="Install_WVC_AutoBodyPart_{bodyTypeName}MechanicalHeadc" or li="Install_WVC_AutoBodyPart_{bodyTypeName}SnakeHeadc"]</xpath>
			</Operation>
			<Operation Class="XmlExtensions.PatchOperationSafeRemove">
				<xpath>/Defs/RecipeDef[defName="Install_WVC_AutoBodyPart_{bodyTypeName}Headc" or li="Install_WVC_AutoBodyPart_{bodyTypeName}MechanicalHeadc" or li="Install_WVC_AutoBodyPart_{bodyTypeName}SnakeHeadc"]</xpath>
			</Operation>
			<Operation Class="XmlExtensions.PatchOperationSafeRemove">
				<xpath>/Defs/ThingDef[@Name="BasePawn"]/recipes[li="Install_WVC_AutoBodyPart_{bodyTypeName}Headc" or li="Install_WVC_AutoBodyPart_{bodyTypeName}MechanicalHeadc" or li="Install_WVC_AutoBodyPart_{bodyTypeName}SnakeHeadc"]</xpath>
			</Operation>

		</apply>
	</XmlExtensions.PatchDef>


</Defs>